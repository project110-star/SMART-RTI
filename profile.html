<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>User Profile</title>
<style>
body {
    margin:0;
    font-family:Arial,sans-serif;
    background:#f1f5f9;
    display:flex;
    flex-direction:column;
    height:100vh;
}

/* ===== TOP BAR ===== */
.topbar {
    background:#0066ff;
    color:#fff;
    padding:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:18px;
    position:relative;
}
.topbar span { font-weight:bold; cursor:pointer; }
.language-selector {
    display:flex;
    gap:10px;
}
.language-selector span {
    cursor:pointer;
    padding:5px 10px;
    border-radius:6px;
    background:rgba(255,255,255,0.2);
    transition:0.2s;
}
.language-selector span.active {
    background:#fff;
    color:#0066ff;
    font-weight:bold;
}

/* ===== MENU ===== */
.menu {
    position:absolute;
    top:60px;
    left:0;
    width:200px;
    background:white;
    box-shadow:2px 2px 10px rgba(0,0,0,0.2);
    display:none;
    flex-direction:column;
    border-radius:0 0 10px 10px;
    z-index:1000;
}
.menu div {
    padding:15px;
    border-bottom:1px solid #eee;
    cursor:pointer;
}
.menu div:hover { background:#f0f0f0; }

/* ===== MAIN CONTENT ===== */
.main-content {
    flex:1;
    overflow-y:auto;
    padding:20px;
}

/* ===== PROFILE CARD ===== */
.profile-card {
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0px 2px 8px rgba(0,0,0,0.15);
    margin-bottom:20px;
}
.profile-card h2 {
    margin-bottom:15px;
    color:#0066ff;
    font-size:20px;
}

/* ===== FORM ELEMENTS ===== */
.profile-card label {
    display:block;
    margin-bottom:5px;
    font-weight:bold;
    color:#333;
}
.profile-card input {
    width:100%;
    padding:12px;
    margin-bottom:15px;
    border-radius:10px;
    border:none;
    box-shadow:0px 2px 6px rgba(0,0,0,0.1);
    font-size:14px;
}

/* ===== BUTTONS ===== */
.update-btn, .logout-btn {
    background:#0066ff;
    color:white;
    padding:12px;
    border:none;
    border-radius:10px;
    font-size:16px;
    font-weight:bold;
    width:100%;
    cursor:pointer;
    transition:background 0.2s, transform 0.2s;
    margin-bottom:10px;
}
.update-btn:hover, .logout-btn:hover {
    background:#004bb5;
    transform:translateY(-2px);
}

/* ===== STATS CARDS ===== */
.stats-container {
    display:flex;
    gap:10px;
    overflow-x:auto;
    margin-bottom:20px;
}
.stats-card {
    min-width:120px;
    background:white;
    padding:15px;
    border-radius:12px;
    box-shadow:0px 2px 8px rgba(0,0,0,0.15);
    flex-shrink:0;
    text-align:center;
}
.stats-title { font-size:14px; color:#555; }
.stats-value { font-size:22px; font-weight:bold; margin-top:5px; }

/* ===== BOTTOM NAV ===== */
.bottom-nav {
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:white;
    display:flex;
    justify-content:space-around;
    padding:12px 0;
    box-shadow:0px -2px 8px rgba(0,0,0,0.15);
    z-index:100;
}
.bottom-nav div { text-align:center; font-size:14px; cursor:pointer; }

/* ===== RESPONSIVE ===== */
@media(max-width:400px) {
    .stats-card { min-width:100px; }
    .update-btn, .logout-btn { font-size:14px; padding:10px; }
    .menu { width:150px; }
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
    <div id="menuToggle">‚ò∞ Menu</div>
    <span>User Profile</span>
    <div class="language-selector">
        <span id="langEN" class="active" onclick="setLanguage('en')">EN</span>
        <span id="langHI" onclick="setLanguage('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</span>
    </div>
</div>

<!-- DROPDOWN MENU -->
<div class="menu" id="menuItems">
    <div onclick="location.href='dashboard.html'">üè† Dashboard</div>
    <div onclick="location.href='track.html'">üìÑ My RTIs</div>
    <div onclick="logout()">üö™ Logout</div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">
    <!-- PROFILE INFO -->
    <div class="profile-card">
        <h2 data-en="My Profile" data-hi="‡§Æ‡•á‡§∞‡•Ä ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤">My Profile</h2>
        <label data-en="Full Name" data-hi="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">Full Name</label>
        <input type="text" id="fullName">

        <label data-en="Email" data-hi="‡§à‡§Æ‡•á‡§≤">Email</label>
        <input type="email" id="email" readonly>

        <label data-en="Mobile Number" data-hi="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">Mobile Number</label>
        <input type="text" id="mobile">

        <button class="update-btn" id="updateBtn" data-en="Update Profile" data-hi="‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç">Update Profile</button>
        <button class="logout-btn" onclick="logout()" data-en="Logout" data-hi="‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü">Logout</button>
    </div>

    <!-- RTI STATS -->
    <div class="stats-container">
        <div class="stats-card">
            <div class="stats-title" data-en="Total RTIs" data-hi="‡§ï‡•Å‡§≤ ‡§Ü‡§∞‡§ü‡•Ä‡§Ü‡§à">Total RTIs</div>
            <div class="stats-value" id="totalRTIs">0</div>
        </div>
        <div class="stats-card">
            <div class="stats-title" data-en="Pending" data-hi="‡§≤‡§Ç‡§¨‡§ø‡§§">Pending</div>
            <div class="stats-value" id="pendingRTIs">0</div>
        </div>
        <div class="stats-card">
            <div class="stats-title" data-en="Processing" data-hi="‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç">Processing</div>
            <div class="stats-value" id="processingRTIs">0</div>
        </div>
        <div class="stats-card">
            <div class="stats-title" data-en="Resolved" data-hi="‡§∏‡•Å‡§≤‡§ù‡§æ ‡§π‡•Å‡§Ü">Resolved</div>
            <div class="stats-value" id="resolvedRTIs">0</div>
        </div>
    </div>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
    <div onclick="location.href='dashboard.html'" data-en="Home" data-hi="‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§†">üè† Home</div>
    <div onclick="location.href='track.html'" data-en="My RTIs" data-hi="‡§Æ‡•á‡§∞‡•á ‡§Ü‡§∞‡§ü‡•Ä‡§Ü‡§à">üìÑ My RTIs</div>
    <div onclick="location.href='profile.html'" data-en="Profile" data-hi="‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤">üë§ Profile</div>
</div>

<script src="https://api.backendless.com/sdk/js/latest/backendless.min.js"></script>
<script>
const APP_ID = "A1EFA0A2-9F5F-4AB4-B41A-34610BD8119F";
const JS_API_KEY = "F7F4D0E1-9677-4715-8C0E-F1FD819B9D69";
Backendless.initApp(APP_ID, JS_API_KEY);

// MENU TOGGLE
const menuToggle = document.getElementById("menuToggle");
const menuItems = document.getElementById("menuItems");
menuToggle.onclick = () => { menuItems.style.display = menuItems.style.display==="flex" ? "none" : "flex"; }

// LOGOUT FUNCTION
function logout(){
    Backendless.UserService.logout()
    .then(()=> { localStorage.clear(); window.location.href = "login.html"; });
}

// LOAD USER PROFILE
async function loadProfile(){
    try{
        const user = await Backendless.UserService.getCurrentUser();
        if(!user) { window.location.href = "login.html"; return; }

        document.getElementById("fullName").value = user.name || "";
        document.getElementById("email").value = user.email || "";
        document.getElementById("mobile").value = user.mobile || "";

        loadRTIStats(user.email);
    }catch(err){ console.error(err); }
}

// UPDATE PROFILE
document.getElementById("updateBtn").addEventListener("click", async ()=>{
    const fullName = document.getElementById("fullName").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    try{
        const user = await Backendless.UserService.getCurrentUser();
        await Backendless.UserService.update({...user, name: fullName, mobile: mobile});
        alert("Profile updated successfully!");
    }catch(err){ console.error(err); alert("Failed to update profile."); }
});

// LOAD RTI STATS
async function loadRTIStats(userEmail){
    try{
        const allRTIs = await Backendless.Data.of("RTI_Forms").find({where:`email='${userEmail}'`});
        document.getElementById("totalRTIs").innerText = allRTIs.length;
        document.getElementById("pendingRTIs").innerText = allRTIs.filter(r=>r.status.toLowerCase()==="pending").length;
        document.getElementById("processingRTIs").innerText = allRTIs.filter(r=>r.status.toLowerCase()==="processing").length;
        document.getElementById("resolvedRTIs").innerText = allRTIs.filter(r=>r.status.toLowerCase()==="resolved").length;
    }catch(err){ console.error(err); }
}

// LANGUAGE SWITCH
function setLanguage(lang){
    document.getElementById('langEN').classList.toggle('active', lang==='en');
    document.getElementById('langHI').classList.toggle('active', lang==='hi');
    document.querySelectorAll('[data-en]').forEach(el=>{
        if(el.tagName==='INPUT' && el.hasAttribute('placeholder')){
            el.placeholder = lang==='en'?el.getAttribute('data-en'):el.getAttribute('data-hi');
        }else el.innerText = lang==='en'?el.getAttribute('data-en'):el.getAttribute('data-hi');
    });
}

// INITIAL LOAD
loadProfile();
</script>
</body>
</html>